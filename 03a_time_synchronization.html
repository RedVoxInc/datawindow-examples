<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Event Data" href="03b_event_data.html" /><link rel="prev" title="Save and Load DataWindow" href="00b_save_load_data_window.html" />

    <link rel="shortcut icon" href="_static/favicon.ico"/><meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Time Synchronization - RedVox DataWindow Examples</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">RedVox DataWindow Examples</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/redvox_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">RedVox DataWindow Examples</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Before Starting...</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prereqs.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_data.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataWindow Basics...</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what_is_data_window.html">What is DataWindow</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_create_data_window.html">Create a DataWindow</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_data_window_metadata.html">Viewing Data Window Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_station.html">Accessing Stations in a DataWindow</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_station_data.html">Accessing Station Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_sensor_data.html">Accessing Sensors in a Station</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataWindow Advanced...</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00a_data_window_parameters.html">DataWindow Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="00b_save_load_data_window.html">Save and Load DataWindow</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Time Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="03b_event_data.html">Event Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="04a_sensor_units.html">Channels and Units of Sensors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For more information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what_to_do_next.html">What to do next?</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="time-synchronization">
<h1>Time Synchronization<a class="headerlink" href="#time-synchronization" title="Permalink to this headline">#</a></h1>
<img src="../../img/dw_fc_ts.png" width="300px"/>
<p>Time synchronization is the process of adjusting raw data timestamps to more accurately represent when the data was
recorded.  This is due to inherent drift in the clocks of devices; that is, not all clocks update their time equally.</p>
<div class="section" id="getting-time-synchronization-data">
<h2>Getting Time Synchronization Data<a class="headerlink" href="#getting-time-synchronization-data" title="Permalink to this headline">#</a></h2>
<p>This example shows how to access time synchronization data from a Station.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">redvox.common.station</span> <span class="kn">import</span> <span class="n">Station</span>

<span class="c1"># Replace the following line with an appropriate method of loading station data</span>
<span class="n">stn</span><span class="p">:</span> <span class="n">Station</span>

<span class="c1"># get the time synchronization data</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">stn</span><span class="o">.</span><span class="n">timesync_data</span><span class="p">()</span>

<span class="c1"># Print the time synchronization exchanges</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">sync_exchanges</span><span class="p">())</span>

<span class="c1"># Print the best latency (for the SDK, it's the lowest)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">best_latency</span><span class="p">())</span>

<span class="c1"># Print all latencies</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">latencies</span><span class="p">())</span>

<span class="c1"># Print the best offset (for the SDK, it's the offset paired with the lowest latency)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">best_offset</span><span class="p">())</span>

<span class="c1"># Print all offsets</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">offsets</span><span class="p">())</span>

<span class="c1"># Print the mean latency of the data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">mean_latency</span><span class="p">())</span>

<span class="c1"># Print the mean offset of the data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">mean_offset</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="keeping-accurate-time">
<h2>Keeping Accurate Time<a class="headerlink" href="#keeping-accurate-time" title="Permalink to this headline">#</a></h2>
<p>According to the <a class="reference external" href="https://www.ntp.org/">NTP standard</a>, clocks have various degrees of accuracy based on the source of
their time.  We assume an NTP clock with a low-numbered stratum is very close to the actual time, and will adjust
timestamps using that as a reference.  To do this, we use a tri-message exchange to give us an idea of how much offset
there is between a recording device’s clock and an NTP server’s clock.</p>
</div>
<div class="section" id="tri-message-exchange">
<h2>Tri-Message Exchange<a class="headerlink" href="#tri-message-exchange" title="Permalink to this headline">#</a></h2>
<p>A tri-message exchange consists of 3 exchanges sent in a series between a server and a device.  The first message
comes from the server, and the device responds, followed by the server responding with one more message.  Whenever a
message is sent or received, the computer sending or receiving the message adds a timestamp based on its clock to the
exchange.  The end result is 2 sets; 3 timestamps from the server and 3 timestamps from the device.</p>
</div>
<div class="section" id="calculating-the-offset">
<h2>Calculating the Offset<a class="headerlink" href="#calculating-the-offset" title="Permalink to this headline">#</a></h2>
<p>We will label the server timestamps as A1, A2, and A3, in ascending order.  We will label the device timestamps as B1,
B2, and B3, in ascending order.  Therefore, the timestamps are created in this order: A1, B1, B2, A2, A3, B3.  We can
now estimate the difference in time, or offset, between the server and the device using these equations:</p>
<blockquote>
<div><p>Offset between server and device: (A1 - B1 + A2 - B2) / 2</p>
<p>Offset between device and server: (A3 - B3 + A2 - B2) / 2</p>
</div></blockquote>
<p>We use the average of the two values to determine the offset during that specific tri-message exchange.</p>
<p>For a given DataWindow, we consider the offset that is paired with the lowest latency as the best representative offset
of the DataWindow.</p>
</div>
<div class="section" id="using-the-offset-to-update-timestamps">
<h2>Using the Offset to Update Timestamps<a class="headerlink" href="#using-the-offset-to-update-timestamps" title="Permalink to this headline">#</a></h2>
<p>We update our raw data timestamps by adding the offset to each.  This allows us to account for offsets that are less
than 0 (meaning the device time is ahead of the server’s).</p>
<p>Return to the section on how to <a class="reference internal" href="03_station_data.html"><span class="doc std std-doc">access the data</span></a>.</p>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="03b_event_data.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Event Data</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="00b_save_load_data_window.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Save and Load DataWindow</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, RedVox, Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/RedVoxInc/datawindow-examples" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Time Synchronization</a><ul>
<li><a class="reference internal" href="#getting-time-synchronization-data">Getting Time Synchronization Data</a></li>
<li><a class="reference internal" href="#keeping-accurate-time">Keeping Accurate Time</a></li>
<li><a class="reference internal" href="#tri-message-exchange">Tri-Message Exchange</a></li>
<li><a class="reference internal" href="#calculating-the-offset">Calculating the Offset</a></li>
<li><a class="reference internal" href="#using-the-offset-to-update-timestamps">Using the Offset to Update Timestamps</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>